<%- include('headers/header', {user: user}); %>
<link rel='stylesheet' type="text/css" href='/plugins/codemirror/lib/codemirror.css'/>
<link rel="stylesheet" type="text/css" href="/plugins/codemirror/theme/ambiance.css"/>
<link rel="stylesheet" type="text/css" href="/plugins/codemirror/theme/solarized.css"/>
<%- include('partials/side-bar', {user: user, activeMenuItem: 'edit-template'}); %>

<div class="row">
    <div class="col-md-1"></div>
    <div class="col-md-10">
        <iframe id="preview-iframe" style="">
        </iframe>
    </div>
    <div class="col-md-1"></div>
</div>
<form id="edit-template-form">
    <div class="row">
        <div class="col-md-12">
            <button type="button" class="btn btn-primary btn-sm" id="edit-template-reload-btn">Reload Code</button>
        </div>
    </div>
    <h3>HTML</h3>
    <div class="row code-row">
        <div class="col-md-1"></div>
        <div class="col-md-10">
            <textarea name="html-text" id="html-text"></textarea>
        </div>
        <div class="col-md-1"></div>
    </div>

    <h3>CSS</h3>
    <div class="row code-row">
        <div class="col-md-1"></div>
        <div class="col-md-10">
            <textarea name="css-text" id="css-text"></textarea>
        </div>
        <div class="col-md-1"></div>
    </div>
</form>

<%- include('footer'); %>
<script src="/plugins/codemirror/lib/codemirror.js" type="text/javascript"></script>
<script src="/plugins/codemirror/mode/css/css.js" type="text/javascript"></script>
<script src="/plugins/codemirror/mode/javascript/javascript.js" type="text/javascript"></script>
<script src="/plugins/codemirror/mode/xml/xml.js" type="text/javascript"></script>
<script src="/plugins/codemirror/mode/htmlmixed/htmlmixed.js" type="text/javascript"></script>
<script type="text/javascript">
    htmlCodeMirror = CodeMirror.fromTextArea(document.getElementById("html-text"), {lineNumbers: true, mode: "htmlmixed", theme: "ambiance" });
    cssCodeMirror = CodeMirror.fromTextArea(document.getElementById("css-text"), {lineNumbers: true, mode: "css", theme: "ambiance"});

    $('#edit-template-reload-btn').click(function() {
        var doc = document.getElementById('preview-iframe').contentWindow.document;
        var body = $('body', doc);
        body.html(htmlCodeMirror.getValue());
        var head = $('head', doc);
        head.html('<title>Test Template</title><style>' + cssCodeMirror.getValue() + '</style>');
    });
</script>
